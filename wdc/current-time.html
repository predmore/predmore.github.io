<html>
<head>
    <title>The Number Will Probably Change</title>
    <meta http-equiv="Cache-Control" content="no-store" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://connectors.tableau.com/libs/tableauwdc-2.0.latest.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.18.1/min/moment.min.js" type="text/javascript"></script>
    <script src="https://momentjs.com/downloads/moment-timezone-with-data-2012-2022.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" type="text/javascript"></script>
    <script>
(function() {
    // Create the connector object
    var myConnector = tableau.makeConnector();
    // Define the schema
    myConnector.getSchema = function(schemaCallback) {
        schemaCallback([{
            id: "currentTime",
            description: "The current time",
            columns: [{
                         id: "time",
                         description: "The current time",
                         dataType: tableau.dataTypeEnum.int
                     }]
        }]);
    };
    // Download the data
    myConnector.getData = function(table, doneCallback) {
        $.ajax({
            url: "http://currentmillis.com/time/minutes-since-unix-epoch.php",
            success: function(result) {
                // Convert from minutes to seconds
                var now = moment.unix((+result) * 60);
                var pacific = now.tz("America/Los_Angeles");

                var dateNumber = +pacific.format("HHmm");

                table.appendRows([{"time": dateNumber}]);
                doneCallback();
            }
        });
    };
    tableau.registerConnector(myConnector);
    // Create event listeners for when the user submits the form
    $(document).ready(function() {
        setTimeout(function() {
            tableau.submit();
        }, 1000);
    });
})();
    </script>
</head>
</html>
